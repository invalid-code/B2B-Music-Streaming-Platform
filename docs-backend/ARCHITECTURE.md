# Architecture Diagram

## Layered Architecture

```
???????????????????????????????????????????????????????????????
?                      API Layer                              ?
?  ????????????????????  ????????????????????  ?????????????????
?  ? PlaylistsCtrl    ?  ? TracksCtrl       ?  ? VenuesCtrl   ??
?  ? /api/playlists   ?  ? /api/tracks      ?  ? /api/venues  ??
?  ????????????????????  ????????????????????  ?????????????????
?????????????????????????????????????????????????????????????????
            ?                      ?                    ?
?????????????????????????????????????????????????????????????????
?                      Service Layer                            ?
?  ????????????????????  ????????????????????  ?????????????????
?  ?PlaylistService   ?  ?TrackService      ?  ?VenueService  ??
?  ?(IPlaylistService)?  ?(ITrackService)   ?  ?(IVenueService)??
?  ?- GetAll()        ?  ?- GetAll()        ?  ?- GetAll()    ??
?  ?- GetById()       ?  ?- GetById()       ?  ?- GetById()   ??
?  ?- Create()        ?  ?- Create()        ?  ?- Create()    ??
?  ?- Update()        ?  ?- Update()        ?  ?- Update()    ??
?  ?- Delete()        ?  ?- Delete()        ?  ?- Delete()    ??
?  ????????????????????  ????????????????????  ?????????????????
?????????????????????????????????????????????????????????????????
            ?                      ?                    ?
?????????????????????????????????????????????????????????????????
?                    Repository Layer                           ?
?  ????????????????????  ????????????????????  ?????????????????
?  ?PlaylistRepository?  ?TrackRepository   ?  ?VenueRepository??
?  ?(Interface)       ?  ?(Interface)       ?  ?(Interface)   ??
?  ????????????????????  ????????????????????  ?????????????????
?           ?                     ?                    ?       ?
?  ????????????????????????????????????????????????????????????
?  ?  GenericRepository<T> (Base Implementation)            ??
?  ?  - GetById()  - GetAll()  - Add()  - Update() - Delete()??
?  ??????????????????????????????????????????????????????????
??????????????????????????????????????????????????????????????
            ?
??????????????????????????????????????????????????????????????
?                   Data Layer                               ?
?  ???????????????????????????????????????????????????????????
?  ? In-Memory Store (Current)                              ??
?  ? List<T> _data                                          ??
?  ?                                                        ??
?  ? OR                                                     ??
?  ?                                                        ??
?  ? Database (Future - Entity Framework Core)             ??
?  ? ApplicationDbContext + SQL Server/PostgreSQL           ??
?  ???????????????????????????????????????????????????????????
???????????????????????????????????????????????????????????????
```

## Data Flow - Create Playlist Example

```
1. HTTP Request
   POST /api/playlists
   {
     "name": "Jazz Vibes",
     "vibeOrGenre": "Jazz",
     "trackIDs": ["track1", "track2"]
   }
   ?
   ?
2. PlaylistsController.CreatePlaylist()
   - Validates ModelState
   - Calls _playlistService.CreatePlaylistAsync()
   ?
   ?
3. PlaylistService.CreatePlaylistAsync()
   - Creates Playlist entity
   - Sets PlaylistID = Guid.NewGuid()
   - Sets CreatedAt = DateTime.UtcNow
   - Calls _playlistRepository.AddAsync()
   ?
   ?
4. PlaylistRepository.AddAsync()
   - Adds Playlist to List<Playlist> _data
   - Returns the added Playlist
   ?
   ?
5. PlaylistService.MapToResponse()
   - Maps Playlist entity to PlaylistResponse DTO
   - Returns PlaylistResponseDto
   ?
   ?
6. PlaylistsController
   - Returns CreatedAtAction()
   - Status: 201 Created
   - Location: /api/playlists/{id}
   - Body: PlaylistResponse object
   ?
   ?
7. HTTP Response
   201 Created
   Location: /api/playlists/abc123def456
   {
     "playlistID": "abc123def456",
     "name": "Jazz Vibes",
     "vibeOrGenre": "Jazz",
     "trackIDs": ["track1", "track2"]
   }
```

## Dependency Injection Container

```
Program.cs Configuration
?
?? Repositories (Scoped Lifetime)
?  ?? IPlaylistRepository ? PlaylistRepository
?  ?? ITrackRepository ? TrackRepository
?  ?? IVenueRepository ? VenueRepository
?
?? Services (Scoped Lifetime)
?  ?? IPlaylistService ? PlaylistService
?  ?   ?? Depends on: IPlaylistRepository
?  ?? ITrackService ? TrackService
?  ?   ?? Depends on: ITrackRepository
?  ?? IVenueService ? VenueService
?      ?? Depends on: IVenueRepository
?
?? Controllers (Created per request)
   ?? PlaylistsController
   ?   ?? Injected with: IPlaylistService
   ?? TracksController
   ?   ?? Injected with: ITrackService
   ?? VenuesController
       ?? Injected with: IVenueService
```

## Entity Relationships

```
???????????????????
?   Playlist      ?
???????????????????
? PlaylistID (PK) ?
? Name            ? ??????
? VibeOrGenre     ?      ? References
? TrackIDs[] ??????????????????????????????
? CreatedAt       ?      ?                ?
???????????????????      ?                ?
                         ?                ?
                    ????????????????????? ?
                    ?   Track           ? ?
                    ????????????????????? ?
                    ? TrackID (PK) ?????? ?
                    ? Title             ? ?
                    ? Artist            ? ?
                    ? Mood              ? ?
                    ? CloudflareStorageKey?
                    ? UploadedAt        ? ?
                    ????????????????????? ?
                                         ?
            ??????????????????????????????
            ?
            ? (Many-to-Many through TrackIDs list)
            ?
????????????????????????????
?   Venue                  ?
????????????????????????????
? VenueID (PK)             ?
? BusinessName             ?
? Location                 ?
? SubscriptionStatus       ?
? (Trial/Paid)             ?
?                          ?
? Subtypes:                ?
? - TrialVenue             ?
?   CheckStreamLimit <= 30 min
?                          ?
? - PaidVenue              ?
?   CheckStreamLimit unlimited
????????????????????????????
```

## Response Mapping (DTO Pattern)

```
Entity (Database Model)          DTO (API Response)
????????????????????           ????????????????????
? Playlist         ?           ? PlaylistResponse ?
????????????????????           ????????????????????
? PlaylistID       ??????????  ? PlaylistID       ?
? Name             ??????????  ? Name             ?
? VibeOrGenre      ??????????  ? VibeOrGenre      ?
? TrackIDs[]       ??????????  ? TrackIDs[]       ?
? CreatedAt        ?           ? (Not included)   ?
? (Internal field) ?           ?                  ?
????????????????????           ????????????????????

Benefits:
- Client doesn't see internal fields
- API contract is stable
- Can change entity without breaking API
```

## Error Handling Flow

```
Request
  ?
  ?
Controller
  ?
  ??? ModelState Invalid? ??? 400 Bad Request
  ?
  ?
Service
  ?
  ??? Business Logic Error? ??? Return false/null
  ?
  ?
Repository
  ?
  ??? Entity not found? ??? Null return
  ?
  ?
Controller
  ?
  ??? Null response? ??? 404 Not Found
  ??? False result? ??? 404 Not Found
  ??? Success? ??? 200/201/204 OK
  ?
  ?
HTTP Response
```
